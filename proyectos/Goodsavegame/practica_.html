<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de Capacitación de Factores</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="practica_data.js"></script>
    <script src="practica2_data.js"></script>
    <style>
        :root {
            --primary-color: #0d9488; /* teal-600 */
            --primary-light: #ccfbf1; /* teal-100 */
            --light-gray: #f1f5f9;   /* slate-100 */
            --medium-gray: #e2e8f0;  /* slate-200 */
            --success-color: #10b981; /* green-500 */
            --error-color: #f43f5e;   /* rose-500 */
            --success-light: #f0fdf4; /* green-50 */
            --error-light: #fff1f2;   /* rose-50 */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        .game-container {
            width: 100%;
            max-width: 700px;
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            overflow: hidden;
        }
        .option-btn {
            transition: all 0.2s ease;
            border: 2px solid var(--medium-gray);
        }
        .option-btn:hover:not(:disabled) {
            border-color: var(--primary-color);
            background-color: var(--primary-light);
            transform: translateY(-2px);
        }
        .option-btn.correct {
            background-color: var(--success-light);
            border-color: var(--success-color);
            color: var(--success-color);
            font-weight: bold;
        }
        .option-btn.incorrect {
            background-color: var(--error-light);
            border-color: var(--error-color);
            color: var(--error-color);
        }
        .feedback {
            min-height: 2rem; /* Reserve space to avoid layout shift */
        }
        .progress-bar-bg {
            background-color: var(--medium-gray);
        }
        .progress-bar-fill {
            background-color: var(--primary-color);
            transition: width 0.3s ease-out;
        }
    </style>
</head>
<body class="text-gray-800 p-4">

    <div id="game-container" class="game-container">
        <div id="practice2-screen" class="hidden p-4 sm:p-6 md:p-8 bg-gray-50">
            <div class="flex justify-between items-center mb-4">
    <h2 class="text-xl font-semibold text-gray-800">Inventario personalizado</h2>
    <button onclick="showStartScreen()" class="bg-gray-500 text-white font-bold py-2 px-5 rounded-lg hover:bg-gray-600 transition-colors">
        Volver
    </button>
</div>
<div class="bg-white shadow-md rounded-lg overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Master Event No.</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">What happened</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Site</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Company</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Site Location</th>
            </tr>
        </thead>
        <tbody id="inventory-table-body" class="bg-white divide-y divide-gray-200">
            <!-- El contenido se generará con JavaScript -->
        </tbody>
    </table>
</div>
        </div>
        
        <!-- Start Screen -->
        <div id="start-screen" class="p-8 text-center">
            <h1 class="text-3xl font-bold text-gray-900 mb-4">Juego de Relación</h1>
            <p class="text-gray-600 mb-8">Selecciona una de las prácticas para comenzar.</p>
            <div class="flex justify-center gap-4">
                <button onclick="startGame()" class="bg-teal-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-teal-700 transition-colors text-lg">
                    Práctica 1
                </button>
                <button onclick="startPractice2()" class="bg-sky-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-sky-700 transition-colors text-lg">
                    Práctica 2
                </button>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="hidden">
            <div class="p-6 md:p-8">
                <div class="flex justify-between items-center mb-2 text-sm font-semibold">
                    <p id="score" class="text-gray-600">Puntuación: 0</p>
                    <p id="question-counter" class="text-gray-600">Racha: 0 / 35</p>
                </div>
                <div class="progress-bar-bg w-full h-2 rounded-full overflow-hidden mb-6">
                    <div id="progress-bar" class="progress-bar-fill h-full" style="width: 0%;"></div>
                </div>

                <div class="bg-slate-50 p-6 rounded-lg border border-slate-200 mb-6">
                    <p class="text-center text-gray-500 text-sm mb-2 font-semibold">¿A qué categoría pertenece la siguiente subcategoría?</p>
                    <h2 id="subcategory-prompt" class="text-2xl font-bold text-center text-teal-700 mb-3"></h2>
                    <p id="example-prompt" class="text-center text-gray-600 text-sm"></p>
                </div>
                
                <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Options will be injected here -->
                </div>
                    <div id="feedback" class="feedback text-center mt-4 font-bold">
                        </div>

                    <div class="text-center mt-4">
                        <button id="next-btn" onclick="nextQuestion()" class="hidden bg-teal-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-teal-700 transition-colors">
                            Siguiente
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- End Screen -->
        <div id="end-screen" class="hidden p-8 text-center">
            <h1 id="end-screen-title" class="text-3xl font-bold text-gray-900 mb-2">¡Juego Terminado!</h1>
            <p id="final-score" class="text-2xl text-gray-700 mb-6"></p>
            <button onclick="showStartScreen()" class="bg-teal-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-teal-700 transition-colors text-lg">
                Jugar de Nuevo
            </button>
        </div>

    </div>
<div id="equipo-modal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-60 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6 sm:p-8">
        <h3 class="text-2xl font-bold text-center text-gray-800 mb-6">Información del Equipo</h3>
        <div class="space-y-4">
            <div>
                <label for="team-name" class="block text-sm font-medium text-gray-700">Nombre del Equipo</label>
                <input type="text" id="team-name" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500">
            </div>
            <div>
                <label for="integrante-1" class="block text-sm font-medium text-gray-700">Integrante 1</label>
                <input type="text" id="integrante-1" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500">
            </div>
            <div>
                <label for="integrante-2" class="block text-sm font-medium text-gray-700">Integrante 2</label>
                <input type="text" id="integrante-2" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500">
            </div>
            <div>
                <label for="integrante-3" class="block text-sm font-medium text-gray-700">Integrante 3</label>
                <input type="text" id="integrante-3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500">
            </div>
            <div>
                <label for="integrante-4" class="block text-sm font-medium text-gray-700">Integrante 4</label>
                <input type="text" id="integrante-4" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500">
            </div>
            <div>
                <label for="integrante-5" class="block text-sm font-medium text-gray-700">Integrante 5</label>
                <input type="text" id="integrante-5" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500">
            </div>
        </div>
        <div class="mt-8 flex justify-end gap-4">
            <button onclick="closeModal()" class="bg-gray-200 text-gray-800 font-bold py-2 px-6 rounded-lg hover:bg-gray-300 transition-colors">
                Cancelar
            </button>
            <button onclick="proceedToPractice2()" class="bg-sky-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-sky-700 transition-colors">
                Continuar
            </button>
        </div>
    </div>
</div>
    <script>

        let questionPool = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let correctStreak = 0;
        const WINNING_STREAK = 35;

        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const endScreen = document.getElementById('end-screen');

        function generateAllQuestions() {
            const allSubcategories = [];
            categoriesData.forEach(category => {
                category.subcategories.forEach(sub => {
                    allSubcategories.push({ ...sub, category: category.title });
                });
            });
            return shuffleArray(allSubcategories);
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function startGame() {
            questionPool = generateAllQuestions();
            localStorage.removeItem('incorrectQuestions');
            
            currentQuestionIndex = 0;
            score = 0;
            correctStreak = 0;
            
            startScreen.classList.add('hidden');
            endScreen.classList.add('hidden');
            document.getElementById('practice2-screen').classList.add('hidden');
            gameScreen.classList.remove('hidden');
            
            displayQuestion();
        }

        function displayQuestion() {
            document.getElementById('next-btn').classList.add('hidden');
            if (correctStreak >= WINNING_STREAK) {
                endGame('win');
                return;
            }

            if (currentQuestionIndex >= questionPool.length) {
                const incorrect = JSON.parse(localStorage.getItem('incorrectQuestions') || '[]');
                if (incorrect.length === 0) {
                    endGame('mastered');
                    return;
                }
                questionPool = shuffleArray(incorrect);
                currentQuestionIndex = 0;
                localStorage.removeItem('incorrectQuestions');
            }

            const question = questionPool[currentQuestionIndex];
            
            // Update UI elements
            document.getElementById('score').textContent = `Puntuación: ${score}`;
            document.getElementById('question-counter').textContent = `Racha: ${correctStreak} / ${WINNING_STREAK}`;
            document.getElementById('progress-bar').style.width = `${(correctStreak / WINNING_STREAK) * 100}%`;
            document.getElementById('subcategory-prompt').textContent = question.name;
            document.getElementById('example-prompt').textContent = `Ejemplo: ${question.example}`;
            document.getElementById('feedback').textContent = '';
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = ''; // Clear previous options

            const correctOption = question.category;
            const incorrectOptions = categoriesData
                .map(cat => cat.title)
                .filter(title => title !== correctOption);
            
            const shuffledIncorrect = shuffleArray(incorrectOptions).slice(0, 3);
            const options = shuffleArray([...shuffledIncorrect, correctOption]);

            options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.className = 'option-btn w-full text-left p-4 rounded-lg font-semibold';
                button.onclick = () => checkAnswer(option, question);
                optionsContainer.appendChild(button);
            });
        }

function checkAnswer(selectedOption, question) {
            const correctOption = question.category;
            const optionsContainer = document.getElementById('options-container');
            const buttons = optionsContainer.getElementsByTagName('button');
            const feedbackEl = document.getElementById('feedback');
            
            // HTML para mostrar ambos ejemplos en el feedback
            const feedbackExamples = `
                                <p class='text-sm font-bold text-gray-800 mt-3'>Qué NO es:</p>
                <p class='text-sm font-normal text-gray-600 mt-1'>${question.nonexample}</p>
            `;

            Array.from(buttons).forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === correctOption) {
                    btn.classList.add('correct');
                } else if (btn.textContent === selectedOption) {
                    btn.classList.add('incorrect');
                }
            });
            
            if (selectedOption === correctOption) {
                score++;
                correctStreak++;
                feedbackEl.innerHTML = `<span class='block'>¡Correcto!</span>` + feedbackExamples;
                feedbackEl.className = "feedback text-center mt-4 font-bold text-green-600";
            } else {
                correctStreak = 0;
                feedbackEl.innerHTML = `<span class='block'>Incorrecto</span>` + feedbackExamples;
                feedbackEl.className = "feedback text-center mt-4 font-bold text-red-600";
                
                let incorrect = JSON.parse(localStorage.getItem('incorrectQuestions') || '[]');
                const isAlreadyInList = incorrect.some(q => q.name === question.name);
                if (!isAlreadyInList) {
                    incorrect.push(question);
                }
                localStorage.setItem('incorrectQuestions', JSON.stringify(incorrect));
            }

            document.getElementById('score').textContent = `Puntuación: ${score}`;
            document.getElementById('question-counter').textContent = `Racha: ${correctStreak} / ${WINNING_STREAK}`;
            document.getElementById('progress-bar').style.width = `${(correctStreak / WINNING_STREAK) * 100}%`;
            
            currentQuestionIndex++;
            document.getElementById('next-btn').classList.remove('hidden');
        }
        function endGame(reason) {
            gameScreen.classList.add('hidden');
            endScreen.classList.remove('hidden');
            const finalScoreEl = document.getElementById('final-score');
            const endTitleEl = document.getElementById('end-screen-title');

            if (reason === 'win') {
                endTitleEl.textContent = '¡Felicidades, has ganado!';
                finalScoreEl.textContent = `¡Alcanzaste la racha de ${WINNING_STREAK} respuestas correctas!`;
            } else if (reason === 'mastered') {
                endTitleEl.textContent = '¡Excelente trabajo!';
                finalScoreEl.textContent = 'Respondiste todas las preguntas correctamente. Tu puntuación final es ' + score + '.';
            }
        }
        function nextQuestion() {
    displayQuestion();
}
        function populatePractice2Table() {
            const tableBody = document.getElementById('inventory-table-body');
            tableBody.innerHTML = ''; // Limpia contenido previo

            inventoryData.forEach((item, index) => {
                const rowClass = index % 2 !== 0 ? 'bg-gray-50' : '';
                const row = `
                    <tr class="${rowClass} cursor-pointer hover:bg-teal-100 transition-colors"
                        onclick="verDetalle('${item.masterEventNo}')">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600">${item.masterEventNo}</td>
                        <td class="px-6 py-4 text-sm text-gray-700" style="white-space: normal; min-width: 300px;">${item.whatHappened}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${item.site}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${item.company}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${item.siteLocation}</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        // NUEVA FUNCIÓN
        function verDetalle(masterEventNo) {
            localStorage.setItem('selectedEvent', masterEventNo);
            window.location.href = 'contenido.html';
        }

        function startPractice2() {
            const gameContainer = document.getElementById('game-container');
            gameContainer.style.maxWidth = '100%';
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('practice2-screen').classList.remove('hidden');
            populatePractice2Table(); // Llama a la función para llenar la tabla
        }

        function showStartScreen() {
            const gameContainer = document.getElementById('game-container');
            gameContainer.style.maxWidth = '';
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('end-screen').classList.add('hidden');
            document.getElementById('practice2-screen').classList.add('hidden');
            document.getElementById('start-screen').classList.remove('hidden');
        }
    </script>
</body>
</html>


